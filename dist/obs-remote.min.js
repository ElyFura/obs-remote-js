/*!
 * OBS Remote JS API v1.0.0 (https://github.com/nodecg/obs-remote-js)
 * Copyright 2014 Matthew McNamara <matt@mattmcn.com>
 * Licensed under MIT (https://github.com/nodecg/obs-remote-js/blob/master/LICENSE)
 */
!function(){"use strict";function a(a,b,c,d,e,f){this.width=a||0,this.height=b||0,this.x=c||0,this.y=d||0,this.name=e||"",this.rendered=f||!1}"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports.OBSSource=a:window.OBSSource=a}(),function(){"use strict";function a(a,b){this.name=a||"",this.sources=b||[]}"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports.OBSScene=a:window.OBSScene=a}(),function(){"use strict";function a(){a.API_VERSION=1.1,a.DEFAULT_PORT=4444,a.WS_PROTOCOL="obsapi",this._connected=!1,this._socket=void 0,this._messageCounter=0,this._responseCallbacks={},this._auth={salt:"",challenge:""}}function b(a,b){var c=e(a),d=e(this._auth.salt),h=f(c+d),i=this;l.subtle.digest("SHA-256",h).then(function(a){var c=e(g(a)),d=e(i._auth.challenge),h=f(c+d);l.subtle.digest("SHA-256",h).then(function(a){var c=g(a);b(c)})})}function c(a,b){var c=e(a),d=e(this._auth.salt),f=CryptoJS.SHA256(c+d).toString(CryptoJS.enc.Base64),g=e(f),h=e(this._auth.challenge),i=CryptoJS.SHA256(g+h).toString(CryptoJS.enc.Base64);b(i)}function d(a,b){var c=l.createHash("sha256"),d=e(a),f=e(this._auth.salt);c.update(d+f);var g=c.digest("base64"),h=l.createHash("sha256"),i=e(g),j=e(this._auth.challenge);h.update(i+j);var k=h.digest("base64");b(k)}function e(a){return unescape(encodeURIComponent(a))}function f(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer}function g(a){for(var b,c,d,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="",g=new Uint8Array(a),h=8*a.byteLength,i=0;h>i;i+=6)b=i/8|0,c=i%8,d=(g[b]||0)<<c>>2,c>2&&(d|=(g[b+1]||0)>>10-c),f+=e.charAt(63&d);return f+=4==c?"=":6==c?"==":""}function h(a){var b=a.name,c=[];return a.sources.forEach(function(a){c.push(i(a))}),new k(b,c)}function i(a){return new j(a.cx,a.cy,a.x,a.y,a.name,a.render)}var j={},k={};"undefined"!=typeof module&&"undefined"!=typeof module.exports?(k=module.exports.OBSScene,j=module.exports.OBSSource):(k=window.OBSScene,j=window.OBSSource);var l={},m={};if("undefined"!=typeof module&&"undefined"!=typeof module.exports)l=require("crypto"),a.prototype._authHash=d,m=require("ws");else{if(l=window.crypto||window.msCrypto||{},a.prototype._authHash=b,"undefined"==typeof l.subtle)if("undefined"==typeof l.webkitSubtle){if("undefined"==typeof CryptoJS)throw new Error("OBS Remote requires CryptoJS when native crypto is not available!");a.prototype._authHash=c}else l.subtle=l.webkitSubtle;m=window.WebSocket}a.prototype.connect=function(b,c){c="undefined"==typeof c?"":c,b="undefined"==typeof b||""===b?"localhost":b;var d=b.indexOf(":");(0>d||d===b.length-1)&&(b+=":"+a.DEFAULT_PORT),this._connected&&(this._socket.close(),this._connected=!1),this._socket="undefined"!=typeof module&&"undefined"!=typeof module.exports?new m("ws://"+b,{protocol:a.WS_PROTOCOL}):new m("ws://"+b,a.WS_PROTOCOL);var e=this;this._socket.onopen=function(){e._connected=!0,e.onConnectionOpened(),e.isAuthRequired(function(a){a&&e.authenticate(c)})},this._socket.onclose=function(){e.onConnectionClosed(),e._connected=!1},this._socket.onerror=function(a){e.onConnectionFailed(a),e._connected=!1},this._socket.onmessage=function(a){e._messageReceived(a)}},a.prototype.authenticate=function(a){var b=this;this._authHash(a,function(a){function c(a){var c="ok"===a.status,d=0;c?b.onAuthenticationSucceeded():(d=a.error.substr(43),b.onAuthenticationFailed(d))}b._sendMessage("Authenticate",{auth:a},c)})},a.prototype.toggleStream=function(a){a="undefined"==typeof a?!1:a,this._sendMessage("StartStopStreaming",{"preview-only":a})},a.prototype.getVersion=function(a){function b(b){a(b.version)}this._sendMessage("GetVersion",b)},a.prototype.isAuthRequired=function(a){function b(b){var d=b.authRequired;d&&(c._auth.salt=b.salt,c._auth.challenge=b.challenge),a(d)}var c=this;this._sendMessage("GetAuthRequired",b)},a.prototype.getSceneList=function(a){function b(b){var c=b["current-scene"],d=[];b.scenes.forEach(function(a){d.push(h(a))}),a(c,d)}this._sendMessage("GetSceneList",b)},a.prototype.getCurrentScene=function(a){function b(b){var c=h(b);a(c)}this._sendMessage("GetCurrentScene",b)},a.prototype.setCurrentScene=function(a){this._sendMessage("SetCurrentScene",{"scene-name":a})},a.prototype.setSourcesOrder=function(a){var b=a;"OBSSource"==typeof a[1]&&(b=[],a.forEach(function(a){b.push(a.name)})),this._sendMessage("SetSourcesOrder",{"scene-names":b})},a.prototype.setSourceRender=function(a,b){this._sendMessage("SetSourceRender",{source:a,render:b})},a.prototype.getStreamingStatus=function(a){function b(b){a(b.streaming,b["preview-only"])}this._sendMessage("GetStreamingStatus",b)},a.prototype.getVolumes=function(a){function b(b){a(b["mic-volume"],b["mic-muted"],b["desktop-volume"],b["desktop-muted"])}this._sendMessage("GetVolumes",b)},a.prototype.setMicrophoneVolume=function(a,b){b="undefined"==typeof b?!1:b,this._sendMessage("SetVolume",{channel:"microphone",volume:a,"final":!b})},a.prototype.toggleMicrophoneMute=function(){this._sendMessage("ToggleMute",{channel:"microphone"})},a.prototype.setDesktopVolume=function(a,b){b="undefined"==typeof b?!1:b,this._sendMessage("SetVolume",{channel:"desktop",volume:a,"final":!b})},a.prototype.toggleDesktopMute=function(){this._sendMessage("ToggleMute",{channel:"desktop"})},a.prototype.onConnectionOpened=function(){},a.prototype.onConnectionClosed=function(){},a.prototype.onConnectionFailed=function(){},a.prototype.onAuthenticationSucceeded=function(){},a.prototype.onAuthenticationFailed=function(){},a.prototype.onStreamStarted=function(){},a.prototype.onStreamStopped=function(){},a.prototype.onStatusUpdate=function(){},a.prototype.onSceneSwitched=function(){},a.prototype.onScenesChanged=function(){},a.prototype.onSourceOrderChanged=function(){},a.prototype.onSourceAddedOrRemoved=function(){},a.prototype.onSourceChanged=function(){},a.prototype.onMicrophoneVolumeChanged=function(){},a.prototype.onDesktopVolumeChanged=function(){},a.prototype._sendMessage=function(a,b,c){if(this._connected){var d=this._getNextMsgId();"function"==typeof b&&(c=b,b={}),b="undefined"==typeof b?{}:b,c="undefined"==typeof c?function(){}:c,this._responseCallbacks[d]=c,b["message-id"]=d,b["request-type"]=a;var e=JSON.stringify(b);this._socket.send(e)}},a.prototype._getNextMsgId=function(){return this._messageCounter+=1,this._messageCounter+""},a.prototype._messageReceived=function(a){var b=JSON.parse(a.data);if(b){var c=this,d=b["update-type"];if(d)switch(d){case"StreamStarting":this.onStreamStarted(b["preview-only"]);break;case"StreamStopping":this.onStreamStopped(b["preview-only"]);break;case"SwitchScenes":this.onSceneSwitched(b["scene-name"]);break;case"StreamStatus":this.onStatusUpdate(b.streaming,b["preview-only"],b["bytes-per-sec"],b.strain,b["total-stream-time"],b["num-total-frames"],b["num-dropped-frames"],b.fps);break;case"ScenesChanged":this.getSceneList(function(a,b){c.onScenesChanged(b)});break;case"SourceOrderChanged":this.getCurrentScene(function(a){c.onSourceOrderChanged(a.sources)});break;case"RepopulateSources":var e=[];b.sources.forEach(function(a){e.push(i(a))}),this.onSourceAddedOrRemoved(e);break;case"SourceChanged":this.onSourceChanged(b["source-name"],i(b.source));break;case"VolumeChanged":var f="desktop"===b.channel?this.onDesktopVolumeChanged:this.onMicrophoneVolumeChanged;f(b.volume,b.muted,!b.finalValue);break;default:console.warn("[OBSRemote] Unknown OBS update type:",d,", full message:"),console.warn(b)}else{var g=b["message-id"];"error"===b.status&&console.error("[OBSRemote] Error:",b.error);var h=this._responseCallbacks[g];h(b),delete this._responseCallbacks[g]}}},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:window.OBSRemote=a}();